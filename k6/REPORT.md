# 부하테스트 Report
https://wiseitree.tistory.com/23

### 부하 테스트 진행
- 상품 데이터 100만개
- 상품 목록 조회 시 브랜드 기반, 좋아요 수 내림차순 정렬
- 첫 번째와 두 번째 페이지 상품 목록에만 캐시 적용

### 테스트 환경
- **부하 테스트 도구**: k6
- **DB 인덱스**: 브랜드 ID, 좋아요 수(like_count)
- **Redis TTL**: 5분
- **캐시 전략**: Cache-aside + Write-through

---

### 단계별 성능 측정 결과

| 단계 | 설정 | 테스트 조건 | EXPLAIN 결과 | RPS | Duration | 비고 |
|----|------|-------------|--------------|------|----------|-----------------------------|
| 0  | 인덱스 없음 | 10분, 500 VUs | type=ALL   | 57.7/s  | 7s       | 응답 지연 심각 |
| 1  | 브랜드 ID 단일 인덱스 | 10분, 500 VUs | type=ALL   | 151.6/s | 2s       | 속도 대폭 개선 |
| 2  | 브랜드 ID + 좋아요 수 단일 인덱스 각각 적용 | 10분, 500 VUs | type=INDEX | 42.1/s  | 9s       | AS-IS보다 느림 |
| 3  | **복합 인덱스** (브랜드 ID, 좋아요 수 desc) | 10분, 1500 VUs | type=REF   | 1.36k/s | 91ms     | 성능 최적 |
| 4  | 복합 인덱스 | 10분, 3000 VUs | type=REF   | 1.4k/s  | 1~2s     | 부하 증가 시 지연 |
| 5  | 복합 인덱스 + Redis | 10분, 3000 VUs | -         | 2.9k/s  | **40ms** | 캐시 효과 큼 |
| 6  | 복합 인덱스 + Redis | 10분, 5000 VUs | -         | 3.6k/s  | 400ms    | 빠름 |
| 7  | 복합 인덱스 + Redis | 10분, 7000 VUs | -         | 3.0k/s  | 1초       | TTL 만료 시 커넥션 고갈 |
| 8  | 복합 인덱스 + Redis | 12분, 7000 VUs | -         | 3.5k/s  | 1초       | TTL 만료 시에도 안정 (VUs↓) |
| 9  | 복합 인덱스 + Redis | 12분, 10000 VUs| -         | 2.3k/s  | -        | TTL 만료 시 에러 다수 발생 |
| 10 | 복합 인덱스 + Redis (캐시 미웜업) | 4분, 30000 VUs | -         | 2.1k/s  | -        | 캐시 웜업 전 초기 요청 폭주 → DB 부하 심각 |


### 결론
1. **복합 인덱스**만으로도 상당한 성능 향상 확인
2. 추가로 Redis 캐시 적용 시 대용량 트래픽 환경에서 매우 효과적임을 확인
3. TTL 만료 시점에는 **캐시 스탬피드** 가능성 존재 확인
4. 캐시 웜업 전 초기 요청 폭주 → DB 부하 심각 → **캐시 웜업** 중요성 확인
